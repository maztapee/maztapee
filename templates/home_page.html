<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo_App Homepage</title>
    <style>
        h1{
            font-style: italic;
            font-weight: bolder;
            color: brown;
            text-align: center;
        }
        ul{
            display: inline-block;
        }
        
        #text_input{
            border-width: 50%;
        }
        #form_position{
            text-align: center;
            width: 100%;
        }
        .center{
            text-align: center;
        }
        #list_position{
            text-align: center;
        }
        ul{
            list-style: none; 
            padding: 0;
            margin: 0;
            width: 450px;
        }
        li button{
            border: none;
            outline: none;
            color: brown;
            float: right;
            cursor: pointer;
            font-size: 15px;
        }
        li{
            clear: both;
            font-weight: bolder;
            text-align: center;
        }
        .error_message{
            display: none;
        }
    </style>
</head>
<body>
    <h1> Welcome CLARA's Reminder, <br> Let us help you get through your schedules today!</h1>
    <div>
        <div class="center">
        <input type="submit" value="Sign-In"> <input type="submit" value="Sign-Up">
        <br>

        <br>

        <br>
        </div>

    <div class="center" id="text_input">
        <form>
            <input type="text" id="" class="" name="username"/>
            <input type="text" id="" class="" name="password"/>

        </form>

    </div>
    <div id="form_position">

        <form id="form">

            <input type="text" id="description" name="description"/>

            <input type="submit" value="Add-Task"/>

        </form>
        <div id="error" class="error_message">

            Something went wrong, new to do task has not been added. Please try again

        </div>

    </div>
    <div id="list_position">
    <ul id="list">
        {% for x in todo_list %} 
        <li id="tasks">
            <input type="checkbox" {% if x.completed %} checked {% endif %} id="check_status" class="check" data-id="{{x.id}}"/>
            {{x.description}}
            <button data-removeid="{{x.id}}" class="button">&cross;</button>
        </li>
        {% endfor %}
    </ul>
    </div>
    
    <script>
        const taskStatus = () =>{
            const checkboxes = document.querySelectorAll('.check');
            for(let i = 0; i < checkboxes.length; i++){
                const checkbox = checkboxes[i];
                checkbox.onchange = function (e){
                    const newCompleted = e.target.checked;
                    const todo_id = e.target.dataset['id'];
                    fetch('todos/'+todo_id+'/boxcheck', {
                        method: 'POST',
                        body: JSON.stringify({
                            'completed': newCompleted
                        }),
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then (function(){
                        document.getElementById('error').className = 'error_message';
                    })
                    .catch (function(){
                        document.getElementById('error').className = '';
                    })
                }
            }
        }
        taskStatus();
        
        document.getElementById('form_position').onsubmit = function(e){
            e.preventDefault();
            
            const validInput = document.getElementById('description').value;
            
            if (validInput.trim().length <= 0) return;
                fetch('/todos/create', {
                method: 'POST',
                body: JSON.stringify({
                    'description': validInput
                }),
                
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(function(response){
                
                return response.json()
            })
            .then(function(jsonResponse){
                
                const new_checkbox = document.createElement('input');
                new_checkbox.setAttribute('type', 'checkbox');
                const new_task = document.createElement('LI');
                new_task.appendChild(new_checkbox);
                new_task.append(jsonResponse['description']);
                const new_delete_button = document.createElement('button');
                new_delete_button.className = "button";
                new_delete_button.innerHTML = "&cross;";
                new_delete_button.setAttribute('data-removeid', jsonResponse.id);
                new_task.appendChild(new_delete_button);
                document.getElementById('list').appendChild(new_task);
                new_delete_button.addEventListener('click', deleteTrigger());
                new_checkbox.addEventListener('change', taskStatus());
                document.getElementById('error').className = 'error_message';
                
            })
            .catch (function(){
                document.getElementById('error').className = '';
            })
            
        }

        
    
    </script>
    
</body>
</html>