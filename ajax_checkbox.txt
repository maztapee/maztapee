<script>
        
        const checkboxes = document.querySelectorAll('.check');
        for(let i = 0; i < checkboxes.length; i++){
            const checkbox = checkboxes[i];
            checkbox.onchange = function (e){
                
                console.log('event', e);
                const newCompleted = e.target.checked;
                const todo_id = e.target.dataset['id'];
                fetch('todos/'+todo_id+'/boxcheck', {
                    method: 'POST',
                    body: JSON.stringify({
                        'completed': newCompleted
                    }),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then (function(){
                    document.getElementById('error').className = 'error_message';
                })
                .catch (function(){
                    document.getElementById('error').className = '';
            })
            }
        }

        document.getElementById('form_position').onsubmit = function(e){
            e.preventDefault();
            
            const validInput = document.getElementById('description').value;
            
            if (validInput.trim().length <= 0) return;

            
            fetch('/todos/create', {
                method: 'POST',
                body: JSON.stringify({
                    'description': validInput
                    
                }),
                
                headers: {
                    'Content-Type': 'application/json'
                }
                
            })
                
            .then(function(response){
                
                return response.json()
                
            })
            .then(function(jsonResponse){
                
                const new_checkbox = document.createElement('input');
                new_checkbox.setAttribute('type', 'checkbox');
                const new_task = document.createElement('LI');
                new_task.appendChild(new_checkbox);
                new_task.append(jsonResponse['description']);
                const new_delete_button = document.createElement('button');
                new_delete_button.className = "button";
                new_delete_button.innerHTML = "&cross;";
                new_delete_button.setAttribute('data-removeid', jsonResponse.id);
                new_delete_button.addEventListener('click', deleteTrigger());
                new_task.appendChild(new_delete_button);
                document.getElementById('list').appendChild(new_task);
                document.getElementById('error').className = 'error_message';
                
            })
            .catch (function(){
                document.getElementById('error').className = '';
            })
            
        }
        const deleteTrigger = () =>{
            const deleteButton = document.querySelectorAll('.button');
            for(let i=0; i< deleteButton.length; i++){
            
                const deletion = deleteButton[i];
                deletion.onclick = function (e){
                
                
                    if(confirm("You are about to delete a task, please confirm to continue")) {
                    console.log('event', e);
                    const todo_id = e.target.dataset['removeid'];
                    fetch('/todos/'+todo_id+'/delete', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                    })
                    console.log(todo_id);
                    deletion.parentElement.remove();

                }  
                
                
            }
        }
     }
    
    deleteTrigger();
    
    </script>